{"version":3,"sources":["webpack:///webpack/bootstrap 67ec602bc2284f8fd882","webpack:///external \"request\"","webpack:///./src/shared/observable-socket.js","webpack:///./src/server/lib/module.js","webpack:///./src/shared/validator.js","webpack:///./src/shared/validation/playlist.js","webpack:///./src/server/modules/chat.js","webpack:///./src/server/modules/playlist.js","webpack:///./src/server/modules/users.js","webpack:///./src/server/repositories/file.js","webpack:///./src/server/services/youtube.js","webpack:///./src/shared/operators.js","webpack:///./webpack.client.js","webpack:///external \"http\"","webpack:///./src/server/lib/request.js","webpack:///./src/shared/validation/chat.js","webpack:///./src/shared/validation/users.js","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///./src/server/server.js"],"names":["clientMessage","fail","success","message","error","Error","throw","successObservable","empty","ObservableSocket","_state","isConnected","isReconnecting","socket","_socket","_actionCallbacks","_requests","_nextRequestId","status$","merge","on$","map","attempt","publishReplay","refCount","subscribe","state","event","fromEvent","callback","on","off","arg","emit","action","id","_registerCallbacks","subject","hasOwnProperty","request","_popRequest","next","complete","console","requestId","value","hasValue","item","_emitError","stack","actions","onAction","ModuleBase","client","Validator","_errors","length","join","push","isValid","errors","validateAddSource","YOUTUBE_REGEXES","url","validator","some","r","test","MAX_HISTORY","BATCH_SIZE","ChatModule","io","usersModule","_io","_users","_chatLog","user","type","trim","throw$","newMessage","name","color","time","Date","getTime","splice","onActions","getUserForClient","sendMessage","PlaylistModule","playlistRepository","videoServices","_repository","_services","_nextSourceId","_playlist","_currentIndex","_currentSource","_currentTime","setInterval","_tickUpdateTime","bind","_tickUpdateClients","getAll$","do","setPlaylist","find","playlist","source","newIndex","indexOf","title","_createCurrentEvent","log","setCurrentSource","getSource$","service","process$","addSource","observer","insertIndex","afterId","totalTime","playNextSource","fromId","toId","fromSource","getSourceById","toSource","fromIndex","toIndex","sourceIndex","isLoggedIn","addSourceFromUrl$","moveSource","deleteSourceById","AuthContext","Symbol","UsersModule","_userList","username","hash","reduce","ch","charCodeAt","Math","abs","hue","saturation","lightness","auth","getColorForUsername","of","index","loginClient$","logoutClient","readFile","bindNodeCallback","writeFile","FileRepository","filename","_filename","JSON","parse","contents","catch","e","items","stringify","YOUTUBE_ENDPOINT","YoutubeService","apiKey","_apiKey","match","a","getSourceFromId$","_buildGetVideoUrl","flatMap","data","snippet","contentDetails","thumb","thumbnails","default","duration","asSeconds","prototype","safeSubscribe","subscription","unsubscribe","catchWrap","fromEventNoDefault","element","preventDefault","fromPrompt","promptText","result","window","prompt","path","require","webpack","ExtractTextPlugin","vendorModules","dirname","resolve","createConfig","isDebug","devTool","plugins","optimize","CommonsChunkPlugin","cssLoader","loader","sassLoader","appEntry","UglifyJsPlugin","extract","HotModuleReplacementPlugin","devtool","entry","application","vendor","output","publicPath","alias","shared","module","loaders","exclude","exports","getJson$","response","body","validateSendMessage","MESSAGE_TYPES","includes","validateLogin","USERNAME_REGEX","isDevelopment","process","env","NODE_ENV","app","server","Server","USE_WEBPACK","webpackMiddleware","webpackHotMiddlware","clientConfig","compiler","use","stats","colors","chunks","assets","timings","modules","version","bgRed","set","static","useExternalStyles","get","req","res","render","users","chat","connection","remoteAddress","mod","registerClient","clientRegistered","port","PORT","startServer","listen","m","init$"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 67ec602bc2284f8fd882","module.exports = request;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"request\"\n// module id = 0\n// module chunks = 0","import {Observable, ReplaySubject} from \"rxjs\";\n\nexport function clientMessage(message) {\n\tconst error = new Error(message);\n\terror.clientMessage = message;\n\treturn error;\n}\n\nexport function fail(message) {\n\treturn Observable.throw({clientMessage: message});\n}\n\nconst successObservable = Observable.empty();\nexport function success() {\n\treturn successObservable;\n}\n\nexport class ObservableSocket {\n\tget isConnected() {\n\t\treturn this._state.isConnected;\n\t}\n\n\tget isReconnecting() {\n\t\treturn this._state.isReconnecting;\n\t}\n\n\tget isTotallyDead() {\n\t\treturn !this.isConnected && !this.isReconnecting;\n\t}\n\n\tconstructor(socket) {\n\t\tthis._socket = socket;\n\t\tthis._state = {};\n\t\tthis._actionCallbacks = {};\n\t\tthis._requests = {};\n\t\tthis._nextRequestId = 0;\n\n\t\tthis.status$ = Observable.merge(\n\t\t\tthis.on$(\"connect\").map(() => ({ isConnected: true })),\n\t\t\tthis.on$(\"disconnect\").map(() => ({ isConnected: false })),\n\t\t\tthis.on$(\"reconnecting\").map(attempt => ({ isConnected: false, isReconnecting: true, attempt })),\n\t\t\tthis.on$(\"reconnect_failed\").map(() => ({ isConnected: false, isReconnecting: false }))\n\t\t)\n\t\t\t.publishReplay(1)\n\t\t\t.refCount();\n\n\t\tthis.status$.subscribe(state => this._state = state);\n\t}\n\n\t/*\n\t * -----------------\n\t * Basic Wrappers\n\t */\n\ton$(event) {\n\t\treturn Observable.fromEvent(this._socket, event);\n\t}\n\n\ton(event, callback) {\n\t\tthis._socket.on(event, callback);\n\t}\n\n\toff(event, callback) {\n\t\tthis._socket.off(event, callback);\n\t}\n\n\temit(event, arg) {\n\t\tthis._socket.emit(event, arg);\n\t}\n\n\t/*\n\t * -----------------\n\t * Emit (Client Side)\n\t */\n\temitAction$(action, arg) {\n\t\tconst id = this._nextRequestId++;\n\t\tthis._registerCallbacks(action);\n\n\t\tconst subject = this._requests[id] = new ReplaySubject(1);\n\t\tthis._socket.emit(action, arg, id);\n\t\treturn subject;\n\t}\n\n\t_registerCallbacks(action) {\n\t\tif (this._actionCallbacks.hasOwnProperty(action)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._socket.on(action, (arg, id) => {\n\t\t\tconst request = this._popRequest(id);\n\t\t\tif (!request) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequest.next(arg);\n\t\t\trequest.complete();\n\t\t});\n\n\t\tthis._socket.on(`${action}:fail`, (arg, id) => {\n\t\t\tconst request = this._popRequest(id);\n\t\t\tif (!request) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trequest.error(arg);\n\t\t});\n\n\t\tthis._actionCallbacks[action] = true;\n\t}\n\n\t_popRequest(id) {\n\t\tif (!this._requests.hasOwnProperty(id)) {\n\t\t\tconsole.error(`Event with id ${id} was returned twice, or the server did not send back an ID!`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst request = this._requests[id];\n\t\tdelete this._requests[id];\n\t\treturn request;\n\t}\n\n\t/*\n\t * -----------------\n\t * On (Server Side)\n\t */\n\tonAction(action, callback) {\n\t\tthis._socket.on(action, (arg, requestId) => {\n\t\t\ttry {\n\t\t\t\tconst value = callback(arg);\n\t\t\t\tif (!value) {\n\t\t\t\t\tthis._socket.emit(action, null, requestId);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (typeof value.subscribe !== \"function\") {\n\t\t\t\t\tthis._socket.emit(action, value, requestId);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet hasValue = false;\n\t\t\t\tvalue.subscribe({\n\t\t\t\t\tnext: item => {\n\t\t\t\t\t\tif (hasValue) {\n\t\t\t\t\t\t\tthrow new Error(`Action ${action} produced more than one value.`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis._socket.emit(action, item, requestId);\n\t\t\t\t\t\thasValue = true;\n\t\t\t\t\t},\n\n\t\t\t\t\terror: error => {\n\t\t\t\t\t\tthis._emitError(action, requestId, error);\n\t\t\t\t\t\tconsole.error(error.stack || error);\n\t\t\t\t\t},\n\n\t\t\t\t\tcomplete: () => {\n\t\t\t\t\t\tif (!hasValue) {\n\t\t\t\t\t\t\tthis._socket.emit(action, null, requestId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tif (typeof requestId !== \"undefined\") {\n\t\t\t\t\tthis._emitError(action, requestId, error);\n\t\t\t\t}\n\n\t\t\t\tconsole.error(error.stack || error);\n\t\t\t}\n\t\t});\n\t}\n\n\tonActions(actions) {\n\t\tfor (const action in actions) {\n\t\t\tif (!actions.hasOwnProperty(action)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.onAction(action, actions[action]);\n\t\t}\n\t}\n\n\t_emitError(action, id, error) {\n\t\tconst message = error && error.clientMessage || \"Fatal Error\";\n\t\tthis._socket.emit(`${action}:fail`, {message}, id);\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/observable-socket.js","import {Observable} from \"rxjs\";\n\n/* eslint no-unused-vars: \"off\"*/\n\nexport class ModuleBase {\n\tinit$() {\n\t\treturn Observable.empty();\n\t}\n\n\tregisterClient(client) {\n\t}\n\n\tclientRegistered(client) {\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/lib/module.js","import {Observable} from \"rxjs\";\n\nexport class Validator {\n\tget isValid() {\n\t\treturn !this._errors.length;\n\t}\n\n\tget errors() {\n\t\treturn this._errors;\n\t}\n\n\tget message() {\n\t\treturn this._errors.join(\", \");\n\t}\n\n\tconstructor() {\n\t\tthis._errors = [];\n\t}\n\n\terror(message) {\n\t\tthis._errors.push(message);\n\t}\n\n\ttoObject() {\n\t\tif (this.isValid) {\n\t\t\treturn {};\n\t\t}\n\n\t\treturn {\n\t\t\terrors: this._errors,\n\t\t\tmessage: this.message\n\t\t};\n\t}\n\n\tthrow$() {\n\t\treturn Observable.throw({clientMessage: this.message});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validator.js","import _ from \"lodash\";\n\nimport {Validator} from \"../validator\";\n\nexport const YOUTUBE_REGEXES = [\n\t/https?:\\/\\/(?:www\\.)?youtube\\.com\\/.*?v=(.*)$/,\n\t/https?:\\/\\/youtu\\.be\\/(.*)/\n];\n\nexport function validateAddSource(url) {\n\tconst validator = new Validator();\n\tif (!_.some(YOUTUBE_REGEXES, r => r.test(url))) {\n\t\tvalidator.error(`Invalid Url`);\n\t}\n\n\treturn validator;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/playlist.js","import {ModuleBase} from \"../lib/module\";\n\nimport {validateSendMessage} from \"shared/validation/chat\";\nimport {fail} from \"shared/observable-socket\";\n\nconst MAX_HISTORY = 100;\nconst BATCH_SIZE = 10;\n\nexport class ChatModule extends ModuleBase {\n\tconstructor(io, usersModule) {\n\t\tsuper();\n\t\tthis._io = io;\n\t\tthis._users = usersModule;\n\t\tthis._chatLog = [];\n\t}\n\n\tsendMessage(user, message, type) {\n\t\tmessage = message.trim();\n\n\t\tconst validator = validateSendMessage(user, message, type);\n\t\tif (!validator.isValid) {\n\t\t\treturn validator.throw$();\n\t\t}\n\n\t\tconst newMessage = {\n\t\t\tuser: {name: user.name, color: user.color},\n\t\t\tmessage,\n\t\t\ttime: new Date().getTime(),\n\t\t\ttype\n\t\t};\n\n\t\tthis._chatLog.push(newMessage);\n\n\t\tif (this._chatLog.length >= MAX_HISTORY) {\n\t\t\tthis._chatLog.splice(0, BATCH_SIZE);\n\t\t}\n\n\t\tthis._io.emit(\"chat:added\", newMessage);\n\t}\n\n\tregisterClient(client) {\n\t\tclient.onActions({\n\t\t\t\"chat:list\": () => {\n\t\t\t\treturn this._chatLog;\n\t\t\t},\n\n\t\t\t\"chat:add\": ({message, type}) => {\n\t\t\t\ttype = type || \"normal\";\n\n\t\t\t\tconst user = this._users.getUserForClient(client);\n\t\t\t\tif (!user) {\n\t\t\t\t\treturn fail(\"You must be logged in\");\n\t\t\t\t}\n\n\t\t\t\tthis.sendMessage(user, message, type);\n\t\t\t}\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/chat.js","import {Observable} from \"rxjs\";\nimport _ from \"lodash\";\n\nimport {ModuleBase} from \"../lib/module\";\n\nimport {fail} from \"shared/observable-socket\";\nimport {validateAddSource} from \"shared/validation/playlist\";\n\nexport class PlaylistModule extends ModuleBase {\n\tconstructor(io, usersModule, playlistRepository, videoServices) {\n\t\tsuper();\n\n\t\tthis._io = io;\n\t\tthis._users = usersModule;\n\t\tthis._repository = playlistRepository;\n\t\tthis._services = videoServices;\n\n\t\tthis._nextSourceId = 1;\n\t\tthis._playlist = [];\n\t\tthis._currentIndex = -1;\n\t\tthis._currentSource = null;\n\t\tthis._currentTime = 0;\n\n\t\tsetInterval(this._tickUpdateTime.bind(this), 1000);\n\t\tsetInterval(this._tickUpdateClients.bind(this), 5000);\n\t}\n\n\tinit$() {\n\t\treturn this._repository.getAll$().do(this.setPlaylist.bind(this));\n\t}\n\n\tgetSourceById(id) {\n\t\treturn _.find(this._playlist, { id });\n\t}\n\n\tsetPlaylist(playlist) {\n\t\tthis._playlist = playlist;\n\n\t\tfor (const source of playlist) {\n\t\t\tsource.id = this._nextSourceId++;\n\t\t}\n\n\t\tthis._io.emit(\"playlist:list\", this._playlist);\n\t}\n\n\tsetCurrentSource(source) {\n\t\tif (source == null) {\n\t\t\tthis._currentSource = null;\n\t\t\tthis._currentIndex = this._currentTime = 0;\n\t\t} else {\n\t\t\tconst newIndex = this._playlist.indexOf(source);\n\t\t\tif (newIndex === -1) {\n\t\t\t\tthrow new Error(`Cannot set current to source ${source.id} / ${source.title}, it was not found`);\n\t\t\t}\n\n\t\t\tthis._currentTime = 0;\n\t\t\tthis._currentSource = source;\n\t\t\tthis._currentIndex = newIndex;\n\t\t}\n\n\t\tthis._io.emit(\"playlist:current\", this._createCurrentEvent());\n\t\tconsole.log(`playlist: setting current to ${source ? source.title : \"{nothing}\"}`);\n\t}\n\n\tplayNextSource() {\n\t\tif (!this._playlist.length) {\n\t\t\tthis.setCurrentSource(null);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._currentIndex + 1 >= this._playlist.length) {\n\t\t\tthis.setCurrentSource(this._playlist[0]);\n\t\t} else {\n\t\t\tthis.setCurrentSource(this._playlist[this._currentIndex + 1]);\n\t\t}\n\t}\n\n\taddSourceFromUrl$(url) {\n\t\tconst validator = validateAddSource(url);\n\t\tif (!validator.isValid) {\n\t\t\treturn validator.throw$();\n\t\t}\n\n\t\treturn new Observable(observer => {\n\t\t\tlet getSource$ = null;\n\n\t\t\tfor (const service of this._services) {\n\t\t\t\tgetSource$ = service.process$(url);\n\n\t\t\t\tif (getSource$) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!getSource$) {\n\t\t\t\treturn fail(`No service accepted url ${url}`);\n\t\t\t}\n\n\t\t\tgetSource$\n\t\t\t\t.do(source => this.addSource(source))\n\t\t\t\t.subscribe(observer);\n\t\t});\n\t}\n\n\taddSource(source) {\n\t\tsource.id = this._nextSourceId++;\n\n\t\tlet insertIndex = 0,\n\t\t\tafterId = -1;\n\n\t\tif (this._currentSource) {\n\t\t\tafterId = this._currentSource.id;\n\t\t\tinsertIndex = this._currentIndex + 1;\n\t\t}\n\n\t\tthis._playlist.splice(insertIndex, 0, source);\n\t\tthis._io.emit(\"playlist:added\", { source, afterId });\n\n\t\tif (!this._currentSource) {\n\t\t\tthis.setCurrentSource(source);\n\t\t}\n\n\t\tconsole.log(`playlist: added ${source.title}`);\n\t}\n\n\t_tickUpdateTime() {\n\t\tif (this._currentSource == null) {\n\t\t\tif (this._playlist.length) {\n\t\t\t\tthis.setCurrentSource(this._playlist[0]);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._currentTime++;\n\t\t\tif (this._currentTime > this._currentSource.totalTime + 2) {\n\t\t\t\tthis.playNextSource();\n\t\t\t}\n\t\t}\n\t}\n\n\t_tickUpdateClients() {\n\t\tthis._io.emit(\"playlist:current\", this._createCurrentEvent());\n\t}\n\n\t_createCurrentEvent() {\n\t\treturn this._currentSource\n\t\t\t? {\n\t\t\t\tid: this._currentSource.id,\n\t\t\t\ttime: this._currentTime\n\t\t\t} : {\n\t\t\t\tid: null,\n\t\t\t\ttime: 0\n\t\t\t};\n\t}\n\n\tmoveSource(fromId, toId) {\n\t\tconst fromSource = this.getSourceById(fromId);\n\t\tif (!fromSource) {\n\t\t\tthrow new Error(`Could not find \"from\" source ${fromId}`);\n\t\t}\n\n\t\tlet toSource = null;\n\t\tif (toId) {\n\t\t\ttoSource = this.getSourceById(toId);\n\t\t\tif (!toSource) {\n\t\t\t\tthrow new Error(`Could not find \"to\" source ${toId}`);\n\t\t\t}\n\t\t}\n\n\t\tconst fromIndex = this._playlist.indexOf(fromSource);\n\t\tthis._playlist.splice(fromIndex, 1);\n\n\t\tconst toIndex = toId ? this._playlist.indexOf(toSource) + 1 : 0;\n\t\tthis._playlist.splice(toIndex, 0, fromSource);\n\n\t\tif (this._currentSource) {\n\t\t\tthis._currentIndex = this._playlist.indexOf(this._currentSource);\n\t\t}\n\n\t\tthis._io.emit(\"playlist:moved\", { fromId, toId });\n\t\tconsole.log(`playlist: moved ${fromSource.title} to ${toSource ? `to after ${toSource.title}` : \"to the beginning\"}`);\n\t}\n\n\tdeleteSourceById(id) {\n\t\tconst source = this.getSourceById(id);\n\t\tif (!source) {\n\t\t\tthrow new Error(`Cannot find source ${id}`);\n\t\t}\n\n\t\tconst sourceIndex = this._playlist.indexOf(source);\n\n\t\tif (source == this._currentSource) {\n\t\t\tif (this._playlist.length == 1) {\n\t\t\t\tthis.setCurrentSource(null);\n\t\t\t} else {\n\t\t\t\tthis.playNextSource();\n\t\t\t}\n\t\t}\n\n\t\tthis._playlist.splice(sourceIndex, 1);\n\n\t\tif (this._currentSource) {\n\t\t\tthis._currentIndex = this._playlist.indexOf(this._currentSource);\n\t\t}\n\n\t\tthis._io.emit(\"playlist:removed\", {id});\n\t\tconsole.log(`playlist: deleted ${source.title}`);\n\t}\n\n\tregisterClient(client) {\n\t\tconst isLoggedIn = () => this._users.getUserForClient(client) !== null;\n\n\t\tclient.onActions({\n\t\t\t\"playlist:list\": () => {\n\t\t\t\treturn this._playlist;\n\t\t\t},\n\n\t\t\t\"playlist:current\": () => {\n\t\t\t\treturn this._createCurrentEvent();\n\t\t\t},\n\n\t\t\t\"playlist:add\": ({url}) => {\n\t\t\t\tif (!isLoggedIn()) {\n\t\t\t\t\treturn fail(\"You must be logged in to do that\");\n\t\t\t\t}\n\n\t\t\t\treturn this.addSourceFromUrl$(url);\n\t\t\t},\n\n\t\t\t\"playlist:set-current\": ({id}) => {\n\t\t\t\tif (!isLoggedIn()) {\n\t\t\t\t\treturn fail(\"You must be logged in to do that\");\n\t\t\t\t}\n\n\t\t\t\tconst source = this.getSourceById(id);\n\t\t\t\tif (!source) {\n\t\t\t\t\treturn fail(`Cannot find source ${id}`);\n\t\t\t\t}\n\n\t\t\t\tthis.setCurrentSource(source);\n\t\t\t},\n\n\t\t\t\"playlist:move\": ({fromId, toId}) => {\n\t\t\t\tif (!isLoggedIn()) {\n\t\t\t\t\treturn fail(\"You must be logged in to do that\");\n\t\t\t\t}\n\n\t\t\t\tthis.moveSource(fromId, toId);\n\t\t\t},\n\n\t\t\t\"playlist:remove\": ({id}) => {\n\t\t\t\tif (!isLoggedIn()) {\n\t\t\t\t\treturn fail(\"You must be logged in to do that\");\n\t\t\t\t}\n\n\t\t\t\tthis.deleteSourceById(id);\n\t\t\t}\n\n\t\t\t// D57e70e236ba4f8d9ebbe1e5c215e656\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/playlist.js","import _ from \"lodash\";\nimport {Observable} from \"rxjs\";\n\nimport {ModuleBase} from \"../lib/module\";\nimport {validateLogin} from \"shared/validation/users\";\nimport {fail} from \"shared/observable-socket\";\n\nconst AuthContext = Symbol(\"AuthContext\");\n\nexport class UsersModule extends ModuleBase {\n\tconstructor(io) {\n\t\tsuper();\n\t\tthis._io = io;\n\t\tthis._userList = [];\n\t\tthis._users = {};\n\t}\n\n\tgetColorForUsername(username) {\n\t\tlet hash = _.reduce(\n\t\t\tusername,\n\t\t\t(hash, ch) => ch.charCodeAt(0) + (hash << 6) + (hash << 16) - hash, 0\n\t\t);\n\n\t\thash = Math.abs(hash);\n\t\tconst hue = hash % 360,\n\t\t\tsaturation = hash % 25 + 70,\n\t\t\tlightness = 100 - (hash % 15 + 35);\n\n\t\treturn `hsl(${hue}, ${saturation}%, ${lightness}%)`;\n\t}\n\n\tgetUserForClient(client) {\n\t\tconst auth = client[AuthContext];\n\t\tif (!auth) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn auth.isLoggedIn ? auth : null;\n\t}\n\n\tloginClient$(client, username) {\n\t\tusername = username.trim();\n\n\t\tconst validator = validateLogin(username);\n\t\tif (!validator.isValid) {\n\t\t\treturn validator.throw$();\n\t\t}\n\n\t\tif (this._users.hasOwnProperty(username)) {\n\t\t\treturn fail(`Username ${username} is already taken`);\n\t\t}\n\n\t\tconst auth = client[AuthContext] || (client[AuthContext] = {});\n\t\tif (auth.isLoggedIn) {\n\t\t\treturn fail(\"You are already logged in\");\n\t\t}\n\n\t\tauth.name = username;\n\t\tauth.color = this.getColorForUsername(username);\n\t\tauth.isLoggedIn = true;\n\n\t\tthis._users[username] = client;\n\t\tthis._userList.push(auth);\n\n\t\tthis._io.emit(\"users:added\", auth);\n\t\tconsole.log(`User ${username} logged in`);\n\t\treturn Observable.of(auth);\n\t}\n\n\tlogoutClient(client) {\n\t\tconst auth = this.getUserForClient(client);\n\t\tif (!auth) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst index = this._userList.indexOf(auth);\n\t\tthis._userList.splice(index, 1);\n\t\tdelete this._users[auth.name];\n\t\tdelete client[AuthContext];\n\n\t\tthis._io.emit(\"users:removed\", auth);\n\t\tconsole.log(`User ${auth.name} logged out`);\n\t}\n\n\tregisterClient(client) {\n\t\tclient.onActions({\n\t\t\t\"users:list\": () => {\n\t\t\t\treturn this._userList;\n\t\t\t},\n\n\t\t\t\"auth:login\": ({name}) => {\n\t\t\t\treturn this.loginClient$(client, name);\n\t\t\t},\n\n\t\t\t\"auth:logout\": () => {\n\t\t\t\tthis.logoutClient(client);\n\t\t\t}\n\t\t});\n\n\t\tclient.on(\"disconnect\", () => {\n\t\t\tthis.logoutClient(client);\n\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/users.js","import fs from \"fs\";\nimport {Observable} from \"rxjs\";\n\nconst readFile = Observable.bindNodeCallback(fs.readFile);\nconst writeFile = Observable.bindNodeCallback(fs.writeFile);\n\nexport class FileRepository {\n\tconstructor(filename) {\n\t\tthis._filename = filename;\n\t}\n\n\tgetAll$() {\n\t\treturn readFile(this._filename)\n\t\t\t.map(contents => JSON.parse(contents))\n\t\t\t.do(() => {\n\t\t\t\tconsole.log(`${this._filename}: got all data`);\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\tconsole.error(`${this._filename}: failed to get all data: ${e.stack || e}`);\n\t\t\t\treturn Observable.throw(e);\n\t\t\t});\n\t}\n\n\tsave$(items) {\n\t\treturn writeFile(this._filename, JSON.stringify(items))\n\t\t\t.do(() => {\n\t\t\t\tconsole.log(`${this._filename}: data saved`);\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\tconsole.error(`${this._filename}: failed to save data: ${e.stack || e}`);\n\t\t\t});\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/repositories/file.js","import {Observable} from \"rxjs\";\nimport moment from \"moment\";\nimport _ from \"lodash\";\n\nimport {getJson$} from \"../lib/request\";\nimport {YOUTUBE_REGEXES} from \"shared/validation/playlist\";\nimport {fail} from \"shared/observable-socket\";\n\nconst YOUTUBE_ENDPOINT = \"https://www.googleapis.com/youtube/v3\";\n\nexport class YoutubeService {\n\tconstructor(apiKey) {\n\t\tthis._apiKey = apiKey;\n\n\t\tif (apiKey === \"{fixme}\") {\n\t\t\tconsole.error(\"Please enter your own YouTube API key in server.js\");\n\t\t}\n\t}\n\n\tprocess$(url) {\n\t\tif (this._apiKey === \"{fixme}\") {\n\t\t\tconsole.error(\"Please enter your own YouTube API key in server.js\");\n\t\t\treturn null;\n\t\t}\n\n\t\tconst match = _(YOUTUBE_REGEXES)\n\t\t\t.map(r => url.match(r))\n\t\t\t.find(a => a != null);\n\n\t\treturn match ? this.getSourceFromId$(match[1]) : null;\n\t}\n\n\tgetSourceFromId$(id) {\n\t\treturn getJson$(this._buildGetVideoUrl(id))\n\t\t\t.flatMap(data => {\n\t\t\t\tif (!data || data.items.length != 1) {\n\t\t\t\t\treturn fail(`Cannot locate youtube video ${id}`);\n\t\t\t\t}\n\n\t\t\t\tconst {id, snippet, contentDetails} = data.items[0];\n\t\t\t\treturn Observable.of({\n\t\t\t\t\ttype: \"youtube\",\n\t\t\t\t\tthumb: snippet.thumbnails.default.url,\n\t\t\t\t\turl: id,\n\t\t\t\t\ttitle: snippet.title || \"{No Title}\",\n\t\t\t\t\ttotalTime: moment.duration(contentDetails.duration).asSeconds()\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\t_buildGetVideoUrl(id) {\n\t\treturn `${YOUTUBE_ENDPOINT}/videos?id=${id}&key=${this._apiKey}&part=snippet,contentDetails,statistics,status`;\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/services/youtube.js","import {Observable} from \"rxjs\";\n\nObservable.prototype.safeSubscribe = function(next, error, complete) {\n\tconst subscription = this.subscribe(\n\t\titem => {\n\t\t\ttry {\n\t\t\t\tnext(item);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e.stack || e);\n\t\t\t\tsubscription.unsubscribe();\n\t\t\t}\n\t\t},\n\t\terror,\n\t\tcomplete\n\t);\n\n\treturn subscription;\n};\n\nObservable.prototype.catchWrap = function() {\n\treturn this.catch(error => Observable.of({error}));\n};\n\nObservable.fromEventNoDefault = function(element, event) {\n\treturn Observable.fromEvent(element, event)\n\t\t.do(e => e.preventDefault());\n};\n\nObservable.fromPrompt = function(promptText) {\n\treturn new Observable(observer => {\n\t\tconst result = window.prompt(promptText);\n\t\tobserver.next(result);\n\t\tobserver.complete();\n\t});\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/operators.js","/* eslint-disable multiline-ternary,no-ternary,no-negated-condition */\nconst path = require(\"path\"),\n\twebpack = require(\"webpack\"),\n\tExtractTextPlugin = require(\"extract-text-webpack-plugin\");\n\nconst vendorModules = [\n\t\"jquery\",\n\t\"lodash\",\n\t\"socket.io-client\",\n\t\"rxjs\",\n\t\"moment\",\n\t\"moment-duration-format\"];\n\nconst dirname = path.resolve(\"./\");\n// eslint-disable-next-line max-statements\nfunction createConfig(isDebug) {\n\tconst devTool = isDebug ? \"eval-source-map\" : \"source-map\";\n\tconst plugins = [new webpack.optimize.CommonsChunkPlugin(\"vendor\", \"vendor.js\")];\n\n\tconst cssLoader = {test: /\\.css$/, loader: \"style!css\"};\n\tconst sassLoader = {test: /\\.scss$/, loader: \"style!css!sass\"};\n\tconst appEntry = [\"./src/client/application.js\"];\n\n\tif (!isDebug) {\n\t\tplugins.push(new webpack.optimize.UglifyJsPlugin());\n\t\tplugins.push(new ExtractTextPlugin(\"[name].css\"));\n\n\t\tcssLoader.loader = ExtractTextPlugin.extract(\"style\", \"css\");\n\t\tsassLoader.loader = ExtractTextPlugin.extract(\"style\", \"css!sass\");\n\t} else {\n\t\tplugins.push(new webpack.HotModuleReplacementPlugin());\n\t\tappEntry.splice(0, 0, \"webpack-hot-middleware/client\");\n\t}\n\n\t// WEBPACK CONFIG\n\treturn {\n\t\tdevtool: devTool,\n\t\tentry: {\n\t\t\tapplication: appEntry,\n\t\t\tvendor: vendorModules\n\t\t},\n\t\toutput: {\n\t\t\tpath: path.join(dirname, \"public\", \"build\"),\n\t\t\tfilename: \"[name].js\",\n\t\t\tpublicPath: \"/build/\"\n\t\t},\n\t\tresolve: {\n\t\t\talias: {\n\t\t\t\tshared: path.join(dirname, \"src\", \"shared\")\n\t\t\t}\n\t\t},\n\t\tmodule: {\n\t\t\tloaders: [\n\t\t\t\t{ test: /\\.js$/, loader: \"babel\", exclude: /node_modules/ },\n\t\t\t\t{ test: /\\.(png|jpg|jpeg|gif|woff|ttf|eot|svg|woff2)/, loader: \"url-loader?limit=1024\" },\n\t\t\t\tcssLoader,\n\t\t\t\tsassLoader\n\t\t\t]\n\t\t},\n\t\tplugins\n\t};\n\t// ---------------------\n}\n\nmodule.exports = createConfig(true);\n\n\n\n// WEBPACK FOOTER //\n// ./webpack.client.js","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 12\n// module chunks = 0","import {Observable} from \"rxjs\";\nimport request from \"request\";\n\nexport function getJson$(url) {\n\treturn new Observable(observer => {\n\t\trequest(url, (error, response, body) => {\n\t\t\tif (error) {\n\t\t\t\tobserver.error(error);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tobserver.next(JSON.parse(body));\n\t\t\tobserver.complete();\n\t\t});\n\t});\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/lib/request.js","import _ from \"lodash\";\nimport {Validator} from \"../validator\";\n\nexport const MESSAGE_TYPES = [\"normal\"];\n\nexport function validateSendMessage(user, message, type) {\n\tconst validator = new Validator();\n\n\tif (message.length > 50) {\n\t\tvalidator.error(\"Message must be smaller than 50 characters\");\n\t}\n\n\tif (message.trim().length === 0) {\n\t\tvalidator.error(\"Message cannot be empty\");\n\t}\n\n\tif (!_.includes(MESSAGE_TYPES, type)) {\n\t\tvalidator.error(`Invalid message type ${type}`);\n\t}\n\n\treturn validator;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/chat.js","import {Validator} from \"../validator\";\n\nexport const USERNAME_REGEX = /^[\\w\\d_-]+$/;\n\nexport function validateLogin(username) {\n\tconst validator = new Validator();\n\n\tif (username.length >= 20) {\n\t\tvalidator.error(\"Username must be fewer than 20 characters\");\n\t}\n\n\tif (!USERNAME_REGEX.test(username)) {\n\t\tvalidator.error(\"Username can only contain numbers, digits, underscores and dashes\");\n\t}\n\n\treturn validator;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/users.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 17\n// module chunks = 0","import \"source-map-support/register\";\n\nimport express from \"express\";\nimport http from \"http\";\nimport socketIo from \"socket.io\";\nimport chalk from \"chalk\";\nimport { Observable } from \"rxjs\";\n\nimport \"shared/operators\";\nimport { ObservableSocket } from \"shared/observable-socket\";\n\nimport { FileRepository } from \"./repositories/file\";\nimport { YoutubeService } from \"./services/youtube\";\n\nimport { UsersModule } from \"./modules/users\";\nimport { PlaylistModule } from \"./modules/playlist\";\nimport { ChatModule } from \"./modules/chat\";\n\nconst isDevelopment = process.env.NODE_ENV !== \"production\";\n\n/*\n * ------------------------\n * Setup\n */\nconst app = express();\nconst server = new http.Server(app);\nconst io = socketIo(server);\n\n/*\n * ------------------------\n * Client Webpack\n */\nif (process.env.USE_WEBPACK === \"true\") {\n\tlet webpackMiddleware = require(\"webpack-dev-middleware\"),\n\t\twebpackHotMiddlware = require(\"webpack-hot-middleware\"),\n\t\twebpack = require(\"webpack\"),\n\t\tclientConfig = require(\"../../webpack.client\");\n\n\tconst compiler = webpack(clientConfig);\n\tapp.use(webpackMiddleware(compiler, {\n\t\tpublicPath: \"/build/\",\n\t\tstats: {\n\t\t\tcolors: true,\n\t\t\tchunks: false,\n\t\t\tassets: false,\n\t\t\ttimings: false,\n\t\t\tmodules: false,\n\t\t\thash: false,\n\t\t\tversion: false\n\t\t}\n\t}));\n\n\tapp.use(webpackHotMiddlware(compiler));\n\tconsole.log(chalk.bgRed(\"Using WebPack Dev Middleware! THIS IS FOR DEV ONLY!\"));\n}\n\n/*\n * ------------------------\n * Configure Express\n */\napp.set(\"view engine\", \"jade\");\napp.use(express.static(\"public\"));\n\nconst useExternalStyles = !isDevelopment;\napp.get(\"/\", (req, res) => {\n\tres.render(\"index\", {\n\t\tuseExternalStyles\n\t});\n});\n\n/*\n * ------------------------\n * Services\n */\nconst videoServices = [new YoutubeService(\"{fixme}\")];\nconst playlistRepository = new FileRepository(\"./data/playlist.json\");\n\n/*\n * ------------------------\n * Modules\n */\nconst users = new UsersModule(io);\nconst chat = new ChatModule(io, users);\nconst playlist = new PlaylistModule(io, users, playlistRepository, videoServices);\nconst modules = [users, chat, playlist];\n\n/*\n * ------------------------\n * Socket\n */\nio.on(\"connection\", socket => {\n\tconsole.log(`Got connection from ${socket.request.connection.remoteAddress}`);\n\n\tconst client = new ObservableSocket(socket);\n\n\tfor (const mod of modules) {\n\t\tmod.registerClient(client);\n\t}\n\n\tfor (const mod of modules) {\n\t\tmod.clientRegistered(client);\n\t}\n});\n\n/*\n * ------------------------\n * Startup\n */\nconst port = process.env.PORT || 3000;\n\nfunction startServer() {\n\tserver.listen(port, () => {\n\t\tconsole.log(`Started http server on ${port}`);\n\t});\n}\n\nObservable.merge(...modules.map(m => m.init$()))\n\t.subscribe({\n\t\tcomplete() {\n\t\t\tstartServer();\n\t\t},\n\n\t\terror(error) {\n\t\t\tconsole.error(`COuld not init module: ${error.stack || error}`);\n\t\t}\n\t});\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js"],"sourceRoot":""}